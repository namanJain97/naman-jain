import requests
import json
from urllib.parse import quote

def call_api_with_bearer_token(access_token, sso_token, where_conditions):
    
    api_url = "http://datafabric-tst:40003/datafabric/Tntr/TNTR-reconciliation-uat"
    
    where_encoded = quote(where_conditions, safe='&')
    query_string = f"where={where_encoded}&accessToken={access_token}"
    
    headers = {
        'Authorization': f'Bearer {sso_token}',
        'Content-Type': 'application/json'
    }
                
    response = requests.get(f"{api_url}?{query_string}", headers=headers)
    
    try:
        response.raise_for_status()  #raise an exception for 4xx and 5xx status codes
        print(response.json())
    except requests.exceptions.HTTPError as e:            
        print(f"HTTP error occurred: {e}")
    except json.decoder.JSONDecodeError as e:
        print(f"Error decoding json response: {e}")
    except Exception as e:
        print(f"An error occurred: {e}")
        #return None
                

access_token = "b0013b54-b771-43f7-b2e0-a86b51fd92aa"
where_conditions = "subjectIdentifier.reconciliationRuleIdentifier='EmirPositionCredit'&reconciliationBusinessDateTime='2022-02-03T00:00:00.000Z'"
sso_token = "Agzncnm3+yjtHus3MNFR+qWGKKwIoyWrCNKKhL92I5EFaYamTyii5kStzJOHAIFJDoL/qUoBbxX+TNJz7vnZr5GphBvERgQIPYn940d+mpPbOJH1/dix6QpBTs1KNs3pzs8uQM5puLYfwk7L3bR2eI6hMsDOJ9Vm2/DE+DF3Vzc=|0|jainnbr|TNTR-User|20230617105748|18000|"

call_api_with_bearer_token(access_token, sso_token, where_conditions)

#if result:
#    print(result)
